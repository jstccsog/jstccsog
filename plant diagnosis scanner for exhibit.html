
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroScan AI: Advanced Plant Health Advisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            color: #166534;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #10b981;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-6">

    <div class="w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden p-8 border-t-8 border-green-600">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-green-800">AgroScan AI</h1>
            <p class="mt-2 text-lg text-gray-500">Your AI-Powered Plant Health Advisor</p>
        </div>
        
        <div class="flex flex-col items-center">
            <label for="file-upload" class="cursor-pointer">
                <div id="image-preview" class="w-64 h-64 border-4 border-dashed border-green-300 rounded-xl flex items-center justify-center text-center text-gray-400 p-4 transition-all hover:border-green-500 hover:text-green-500">
                    <div id="placeholder" class="space-y-2">
                        <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 18H4a2 2 0 01-2-2V6a2 2 0 012-2h12a2 2 0 012 2v8a2 2 0 01-2 2h-2m-8-2h6"></path></svg>
                        <p class="font-medium">Click to upload a plant image</p>
                    </div>
                </div>
            </label>
            <input id="file-upload" type="file" class="hidden" accept="image/*" />
        </div>

        <div id="loading" class="mt-8 flex items-center justify-center hidden">
            <div class="loader"></div>
            <p class="ml-4 text-gray-500">Analyzing your plant...</p>
        </div>

        <div id="result-container" class="mt-8 p-6 rounded-2xl bg-white shadow-inner hidden">
            <h2 id="result-title" class="text-2xl font-bold text-green-700 mb-2"></h2>
            <p id="result-text" class="text-gray-600 leading-relaxed"></p>
        </div>
        
        <div id="error-container" class="mt-8 p-6 rounded-2xl bg-red-50 text-red-700 font-medium hidden">
            <p>An error occurred. Please try again with a clear image of a plant leaf.</p>
        </div>
    </div>

    <script>
        const fileUpload = document.getElementById('file-upload');
        const imagePreview = document.getElementById('image-preview');
        const placeholder = document.getElementById('placeholder');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('result-container');
        const resultTitle = document.getElementById('result-title');
        const resultText = document.getElementById('result-text');
        const errorContainer = document.getElementById('error-container');

        // Your provided API key
        const apiKey = 'AIzaSyDtFEFrqvGu22FaXR3RpvpRWfUbucmRQqw';
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        fileUpload.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                // Clear previous results and errors
                resultContainer.classList.add('hidden');
                errorContainer.classList.add('hidden');
                loading.classList.remove('hidden');
                placeholder.classList.add('hidden');

                const reader = new FileReader();
                reader.onload = async (e) => {
                    imagePreview.innerHTML = `<img src="${e.target.result}" alt="Uploaded Plant Image" class="w-full h-full object-cover rounded-xl border-4 border-green-500" />`;

                    const base64Data = e.target.result.split(',')[1];
                    
                    const prompt = "Analyze the plant in the image. Identify any potential diseases, pests, or nutritional deficiencies. Then, provide a diagnosis and specific, actionable advice for treatment or care. Please keep the diagnosis concise and the advice practical and easy to follow. If the plant looks healthy, state that it's healthy and provide general care tips.";

                    const payload = {
                        contents: [
                            {
                                role: "user",
                                parts: [
                                    { text: prompt },
                                    {
                                        inlineData: {
                                            mimeType: file.type,
                                            data: base64Data
                                        }
                                    }
                                ]
                            }
                        ],
                    };

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }

                        const result = await response.json();
                        const analysisText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "No analysis available.";
                        
                        const titleMatch = analysisText.match(/^(.*?)\n/);
                        const title = titleMatch ? titleMatch[1].trim() : "Diagnosis:";
                        const textContent = analysisText.substring(title.length).trim();

                        resultTitle.textContent = title;
                        resultText.textContent = textContent;
                        resultContainer.classList.remove('hidden');

                    } catch (error) {
                        console.error("Error during API call:", error);
                        errorContainer.classList.remove('hidden');
                    } finally {
                        loading.classList.add('hidden');
                    }
                };
                reader.readAsDataURL(file);
            } else {
                errorContainer.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>